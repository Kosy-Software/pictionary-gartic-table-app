(()=>{"use strict";(()=>{function e(e,t){let i=document.querySelector("#viewing").content.firstElementChild.cloneNode(!0),s=i.querySelector("iframe");return s.style.height="100vh",s.style.width="100vw",s.src=`${e.gameRoomUrl}`,i}function t(e){return e&&e.match("https://([w.-]+.)?gartic.io")}function i(e,i){let s=document.querySelector("#picking").content.cloneNode(!0),n=s.querySelector("input"),o=s.querySelector("#start-game");document.querySelector("#viewing").hidden=!0;let a=s.querySelector("#error");return n.oninput=e=>{const i=n.value;n.classList.remove("invalid"),n.classList.remove("valid"),o.classList.remove("valid"),t(i)?(o.removeAttribute("disabled"),a.innerHTML="",a.style.marginBottom="0",a.style.marginTop="0",n.style.color="black",o.classList.add("valid"),n.classList.add("valid")):(a.innerHTML="This is an invalid game room url",a.style.marginBottom="16px",a.style.marginTop="5px",o.setAttribute("disabled","disabled"),n.classList.add("invalid"),n.style.color="red")},o.onclick=e=>{let t=n.value;i({type:"game-room-url-changed",payload:t})},s}function s(e,t){let i=document.querySelector("#waiting").content.firstElementChild.cloneNode(!0);return i.querySelector("h3").innerHTML=`${e.initializer.clientName} is setting up a game`,i}class n{constructor(e){this.kosyClient=window.parent,this.kosyApp=e}startApp(){return new Promise(((e,t)=>{window.addEventListener("message",(t=>{let i=t.data;switch(i.type){case"receive-initial-info":e(i.payload);break;case"client-has-joined":this.kosyApp.onClientHasJoined(i.payload);break;case"client-has-left":this.kosyApp.onClientHasLeft(i.clientUuid);break;case"get-app-state":const t=this.kosyApp.onRequestState();this._sendMessageToKosy({type:"receive-app-state",payload:t,clientUuids:i.clientUuids});break;case"set-app-state":this.kosyApp.onProvideState(i.state);break;case"receive-message":this.kosyApp.onReceiveMessage(i.payload)}})),this._sendMessageToKosy({type:"ready-and-listening"})}))}stopApp(){this._sendMessageToKosy({type:"stop-app"})}relayMessage(e){this._sendMessageToKosy({type:"relay-message",payload:e})}_sendMessageToKosy(e){this.kosyClient.postMessage(e,"*")}}var o;!function(o){var a;(function(o){class a{constructor(){this.state={gameRoomUrl:null},this.kosyApi=new n({onClientHasJoined:e=>this.onClientHasJoined(e),onClientHasLeft:e=>this.onClientHasLeft(e),onReceiveMessage:e=>this.processMessage(e),onRequestState:()=>this.getState(),onProvideState:e=>this.setState(e)})}start(){var e,t,i,s,n;return t=this,i=void 0,n=function*(){let t=yield this.kosyApi.startApp();this.initializer=t.clients[t.initializerClientUuid],this.currentClient=t.clients[t.currentClientUuid],this.state=null!==(e=t.currentAppState)&&void 0!==e?e:this.state,this.renderComponent(),window.addEventListener("message",(e=>{this.processComponentMessage(e.data)}))},new((s=void 0)||(s=Promise))((function(e,o){function a(e){try{l(n.next(e))}catch(e){o(e)}}function r(e){try{l(n.throw(e))}catch(e){o(e)}}function l(t){var i;t.done?e(t.value):(i=t.value,i instanceof s?i:new s((function(e){e(i)}))).then(a,r)}l((n=n.apply(t,i||[])).next())}))}setState(e){this.state=e,this.renderComponent()}getState(){return this.state}onClientHasJoined(e){}onClientHasLeft(e){}processMessage(e){switch(e.type){case"receive-game-room-url":t(e.payload)&&(this.state.gameRoomUrl=`${e.payload}`,this.renderComponent())}}processComponentMessage(e){switch(e.type){case"game-room-url-changed":this.kosyApi.relayMessage({type:"receive-game-room-url",payload:e.payload})}}renderComponent(){!function(t,n){let o,a=document.getElementById("root");o=(null==t?void 0:t.gameRoomUrl)?e:t.currentClient.clientUuid==t.initializer.clientUuid?i:s;var r=a.cloneNode(!1);a.parentNode.replaceChild(r,a),r.appendChild(o(t,n))}({gameRoomUrl:this.state.gameRoomUrl,currentClient:this.currentClient,initializer:this.initializer},(e=>this.processComponentMessage(e)))}log(...e){var t,i;console.log(`${null!==(i=null===(t=this.currentClient)||void 0===t?void 0:t.clientName)&&void 0!==i?i:"New user"} logged: `,...e)}}o.App=a,(new a).start()})((a=o.Integration||(o.Integration={})).Figma||(a.Figma={}))}(o||(o={}))})()})();